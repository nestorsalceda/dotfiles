#!/bin/zsh

function create_symlinks {
	symlinks=(vimrc gvimrc gitconfig hgrc tmux.conf dircolors agignore)
	for symlink in $symlinks; do
		echo "Creating symlink to ~/.$symlink"
		ln -sf $PWD/$symlink ~/.$symlink
	done
}

function clone_or_upgrade_repository {
	repository=$1
	destination=$2
	if [[ ! -d $destination ]]; then
		git clone --recursive $repository $destination
	else
		pushd $destination
		git pull
		git submodule update --init --recursive
		popd
	fi
}

function install_or_upgrade_vundle {
	clone_or_upgrade_repository https://github.com/gmarik/Vundle.vim.git ~/.vim/bundle/Vundle.vim
	vim -c "PluginInstall" -c ":q!" -c ":q!"
}

function install_or_upgrade_prezto {
	zprezto_dir=~/.zprezto
	clone_or_upgrade_repository https://github.com/sorin-ionescu/prezto.git $zprezto_dir
	create_prezto_symlinks
	echo "Creating symlink to ~/.zshrc"
	ln -sf $PWD/zsh/zshrc ~/.zshrc
	echo "Creating symlink to ~/.zpreztorc"
	ln -sf $PWD/zsh/zpreztorc ~/.zpreztorc
	echo "Creating symlink to $zprezto_dir/modules/prompt/functions/prompt_nestorsalceda_setup"
	ln -sf $PWD/zsh/prompt_nestorsalceda_setup $zprezto_dir/modules/prompt/functions/prompt_nestorsalceda_setup
}

function create_prezto_symlinks {
	setopt EXTENDED_GLOB
	for rcfile in ~/.zprezto/runcoms/^README.md(.N); do
		ln -sf $rcfile ~/.${rcfile:t}
	done
}

create_symlinks
install_or_upgrade_vundle
install_or_upgrade_prezto
